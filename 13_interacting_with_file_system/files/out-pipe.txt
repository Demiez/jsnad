'USE STRICT';
CONST { PIPELINE, TRANSFORM } = REQUIRE('STREAM');
CONST { JOIN } = REQUIRE('PATH');
CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE('FS');

CONST CREATEUPPERCASESTREAM = () => {
  RETURN NEW TRANSFORM({
    TRANSFORM(CHUNK, ENC, NEXT) {
      CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE();

      NEXT(NULL, UPPERCASED);
    },
  });
};

PIPELINE(
  CREATEREADSTREAM(__FILENAME),
  CREATEUPPERCASESTREAM(),
  CREATEWRITESTREAM(JOIN(__DIRNAME, 'FILES/OUT-PIPE.TXT')),
  (ERR) => {
    IF (ERR) {
      CONSOLE.ERROR(ERR);
      RETURN;
    }
    CONSOLE.LOG('FINISHED WRITING THROUGH TRANSFORM');
  }
);
